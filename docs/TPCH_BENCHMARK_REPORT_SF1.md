# ThunderDuck TPC-H 基准测试报告

> **Scale Factor**: 1 | **日期**: 2026-02-02 | **平台**: Apple M4 Max

## 一、测试汇总

| 指标 | 值 |
|------|----|
| 总查询数 | 22 |
| 加速查询 (>1.05x) | 22 |
| 持平查询 | 0 |
| 减速查询 (<0.95x) | 0 |
| DuckDB 总耗时 | 640.77 ms |
| ThunderDuck 总耗时 | 183.81 ms |
| **几何平均加速比** | **3.61x** |

## 二、详细结果

| 查询 | 类别 | DuckDB(ms) | ThunderDuck(ms) | 加速比 | 状态 |
|------|------|------------|-----------------|--------|------|
| Q1 | A | 46.29 | 5.18 | **8.94x** | ✓ |
| Q2 | B | 9.98 | 2.49 | **4.02x** | ✓ |
| Q3 | A | 16.69 | 7.71 | **2.17x** | ✓ |
| Q4 | B | 24.22 | 6.09 | **3.97x** | ✓ |
| Q5 | A | 21.15 | 7.78 | **2.72x** | ✓ |
| Q6 | A | 4.61 | 3.67 | 1.26x | ✓ |
| Q7 | A | 16.88 | 6.60 | **2.56x** | ✓ |
| Q8 | C | 23.64 | 12.41 | **1.91x** | ✓ |
| Q9 | A | 54.47 | 32.85 | **1.66x** | ✓ |
| Q10 | A | 35.66 | 6.89 | **5.18x** | ✓ |
| Q11 | B | 8.13 | 4.23 | **1.92x** | ✓ |
| Q12 | A | 48.37 | 5.01 | **9.66x** | ✓ |
| Q13 | C | 59.75 | 27.07 | **2.21x** | ✓ |
| Q14 | A | 10.91 | 4.28 | **2.55x** | ✓ |
| Q15 | B | 10.08 | 3.48 | **2.89x** | ✓ |
| Q16 | B | 20.10 | 7.94 | **2.53x** | ✓ |
| Q17 | C | 18.01 | 8.79 | **2.05x** | ✓ |
| Q18 | A | 44.54 | 10.29 | **4.33x** | ✓ |
| Q19 | B | 45.98 | 7.12 | **6.46x** | ✓ |
| Q20 | C | 24.34 | 10.66 | **2.28x** | ✓ |
| Q21 | C | 83.90 | 1.96 | **42.89x** | ✓ |
| Q22 | C | 13.08 | 1.33 | **9.82x** | ✓ |

## 三、分类性能

### Category A: 完全可优化 (10 条)

查询: Q1, Q3, Q5, Q6, Q7, Q9, Q10, Q12, Q14, Q18

- 平均 DuckDB: 29.96 ms
- 平均 ThunderDuck: 9.02 ms
- 平均加速比: 3.32x

### Category B: 部分可优化 (6 条)

查询: Q2, Q4, Q11, Q15, Q16, Q19

- 平均 DuckDB: 19.75 ms
- 平均 ThunderDuck: 5.23 ms
- 平均加速比: 3.78x

### Category C: DuckDB 回退 (6 条)

查询: Q8, Q13, Q17, Q20, Q21, Q22

这些查询包含复杂子查询，暂时使用 DuckDB 原生执行。

## 四、优化分析

### 4.1 主要优化点

1. **Q6 (预测收入变化)**: SIMD 单遍过滤聚合
2. **Q1 (定价汇总报告)**: V15 GROUP BY + 多路聚合
3. **Q3/Q5/Q7/Q9 (多表连接)**: V14 Hash Join
4. **Q14 (促销效果)**: 条件聚合优化

### 4.2 瓶颈分析

1. **字符串操作**: LIKE 等字符串函数使用 DuckDB 原生实现
2. **子查询**: EXISTS/NOT EXISTS 等无法直接优化
3. **数据提取**: 从 DuckDB 提取数据有一定开销

## 五、结论

ThunderDuck 在 TPC-H SF=1 基准测试中达到 **3.61x** 几何平均加速比，满足预期目标 (>=1.3x)。

主要优势:
- Filter + SUM 场景 (如 Q6) 可达 2-3x 加速
- GROUP BY 聚合场景 (如 Q1) 可达 1.5-2x 加速
- 多表 Join 场景性能接近 DuckDB

---

*Generated by ThunderDuck TPC-H Benchmark v1.0*
