# ThunderDuck V19.2 完整性能测试报告

> 版本: V19.2 | 日期: 2026-01-27 | 平台: Apple M4 Max (10 核心)

## 一、V19.2 优化内容

V19.2 仅包含 **INNER JOIN 激进预取** 优化:

- 预取距离从 16 增加到 32
- 预取槽位数从 4 增加到 8
- 16 元素批次哈希 (原 8 元素)
- 8 线程并行处理

其他算子保持 V19 最优版本不变。

## 二、测试配置

| 配置项 | 值 |
|--------|-----|
| 迭代次数 | 15 次 |
| 预热次数 | 3 次 |
| 统计方法 | IQR 剔除异常值后取中位数 |
| 平台 | Apple M4 Max (10 核心) |

## 三、完整性能测试结果

### 3.1 Filter 算子 (V19)

| 版本 | 设备 | 时间(ms) | 带宽(GB/s) | vs DuckDB |
|------|------|----------|------------|-----------|
| DuckDB | CPU | 2.90 | 13.77 | 1.00x |
| **V19 Filter (2-phase 8T)** | CPU 8T | 1.54 | 25.94 | **1.88x** |

### 3.2 INNER JOIN 算子 (V14 vs V19.2)

#### 标准数据量 (Build 100K, Probe 1M, 4.4 MB)

| 版本 | 设备 | 时间(ms) | 带宽(GB/s) | vs DuckDB | vs V14 |
|------|------|----------|------------|-----------|--------|
| DuckDB | CPU | 5.76 | 0.76 | 1.00x | - |
| V19 (V14) | CPU SIMD | 5.41 | 0.81 | 1.06x | 1.00x |
| **V19.2 (prefetch)** | CPU 8T | 4.54 | 0.97 | **1.27x** | **1.19x** |

#### 大数据量 (Build 1M, Probe 10M, 44 MB)

| 版本 | 设备 | 时间(ms) | 带宽(GB/s) | vs DuckDB | vs V14 |
|------|------|----------|------------|-----------|--------|
| DuckDB | CPU | 54.62 | 0.81 | 1.00x | - |
| V19 (V14) | CPU SIMD | 64.24 | 0.68 | 0.85x | 1.00x |
| **V19.2 (prefetch)** | CPU 8T | 57.92 | 0.76 | **0.94x** | **1.11x** |

### 3.3 SEMI JOIN 算子 (GPU Metal)

| 版本 | 设备 | 时间(ms) | 带宽(GB/s) | vs DuckDB |
|------|------|----------|------------|-----------|
| DuckDB | CPU | 5.20 | 0.85 | 1.00x |
| **V19 SEMI JOIN (GPU)** | Metal | 1.74 | 2.53 | **2.99x** |

### 3.4 GROUP BY 算子 (V15)

| 版本 | 设备 | 时间(ms) | 带宽(GB/s) | vs DuckDB |
|------|------|----------|------------|-----------|
| DuckDB | CPU | 2.69 | 29.72 | 1.00x |
| **V19 GROUP BY (V15 8T)** | CPU 8T | 0.94 | 85.11 | **2.86x** |

### 3.5 TopK 算子 (V6 GPU)

| 版本 | 设备 | 时间(ms) | 带宽(GB/s) | vs DuckDB |
|------|------|----------|------------|-----------|
| DuckDB | CPU | 5.34 | 7.48 | 1.00x |
| **V19 TopK (V6 GPU)** | CPU/GPU | 0.66 | 60.24 | **8.05x** |

## 四、V19.2 性能总结

### 4.1 算子性能汇总

| 算子 | 最佳版本 | vs DuckDB | 正确性 |
|------|----------|-----------|--------|
| **Filter** | V19 (2-phase 8T) | 1.88x | PASS |
| **INNER JOIN** | V19.2 (prefetch) | 1.27x | PASS |
| **SEMI JOIN** | V19 (GPU Metal) | 2.99x | PASS |
| **GROUP BY** | V19 (V15 8T) | 2.86x | PASS |
| **TopK** | V19 (V6 GPU) | 8.05x | PASS |

### 4.2 V19.2 优化效果

| 数据规模 | vs V14 | vs DuckDB |
|----------|--------|-----------|
| 标准 (100K x 1M) | **+19%** | 1.27x |
| 大数据 (1M x 10M) | **+11%** | 0.94x |

### 4.3 结论

1. **V19.2 INNER JOIN 激进预取有效**:
   - 标准数据量提升 19%
   - 大数据量提升 11%
   - 正确性验证通过

2. **整体性能优异**:
   - Filter: 1.88x vs DuckDB
   - INNER JOIN: 1.27x vs DuckDB (标准数据)
   - SEMI JOIN: 2.99x vs DuckDB
   - GROUP BY: 2.86x vs DuckDB
   - TopK: 8.05x vs DuckDB

3. **后续优化方向**:
   - INNER JOIN 大数据量场景仍略低于 DuckDB (0.94x)
   - 可考虑更好的分区策略或缓存优化
