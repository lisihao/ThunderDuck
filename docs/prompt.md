# ThunderDuck 开发提示词记录

> 记录项目开发过程中的用户提示词，便于复盘和参考

---

## 1. UMA 架构重构

```
将你之前所有的性能优化设计，都依照UMA优化思路重新梳理、架构设计和算法设计，给出具体方案
```

**目标**: 基于 Apple Silicon 统一内存架构重新设计所有算子

**产出**:
- UMA 内存管理器 (`uma_memory.h/mm`)
- UMA 数据块 (`uma_data_chunk.h/mm`)
- Filter v4 UMA 实现
- Aggregate v3 UMA 实现
- TopK v6 UMA 实现
- Join UMA GPU 实现

---

## 2. 全面性能基准测试

```
基于最新性能架构设计，你做一次全面、详细的benchmark测试，要把执行的sql、访问数据量、操作算子、调用的cpu或gpu或npu、访问数据量、数据吞吐带宽、sql执行时长、和v3版本及DuckDB原版的性能加速比等，让我可以找到那些点继续优化
```

**目标**: 全面评估各算子性能，找出优化点

**产出**:
- `benchmark/comprehensive_uma_benchmark.cpp` - 综合基准测试程序
- `docs/UMA_BENCHMARK_REPORT.md` - 详细性能报告

**关键发现**:
- Filter CPU SIMD: ~2,500 M rows/s
- Aggregate CPU: 达 118 GB/s 带宽
- Join UMA GPU: 4x 加速 (最佳区间)
- GPU 启动开销在小数据量时主导

---

## 3. 性能优化实现

```
根据性能报告的建议，进一步进行性能优化设计和实现
```

**目标**: 实现报告中建议的优化项

**产出**:
- `include/thunderduck/adaptive_strategy.h` - 自适应策略选择器
- `src/core/adaptive_strategy.cpp` - 策略选择逻辑
- `docs/ADAPTIVE_STRATEGY_DESIGN.md` - 设计文档

**优化内容**:
- Join GPU 阈值优化 (probe >= 500K)
- 集成策略选择器到所有算子
- 验证性能提升 (J3 达 4.3x 加速)

---

## 4. 提示词整理

```
将我之前写的提示词都列出来，写成一个文档prompt.md
```

**目标**: 记录开发过程中的提示词

---

## 提示词设计模式

### 模式 1: 架构重构
```
将你之前所有的[X]设计，都依照[Y]思路重新梳理、架构设计和算法设计，给出具体方案
```

### 模式 2: 全面测试
```
基于最新[X]设计，你做一次全面、详细的benchmark测试，要把[测试维度列表]等，让我可以找到那些点继续优化
```

### 模式 3: 迭代优化
```
根据[X]报告的建议，进一步进行性能优化设计和实现
```

---

## 开发流程

```
需求 → 架构设计 → 实现 → 测试 → 分析 → 优化 → 验证
  ↑                                           │
  └───────────────────────────────────────────┘
```

1. **需求阶段**: 明确优化目标 (UMA 架构)
2. **设计阶段**: 重构所有算子设计
3. **实现阶段**: 编码各模块
4. **测试阶段**: 全面基准测试
5. **分析阶段**: 性能报告和瓶颈分析
6. **优化阶段**: 针对性优化 (自适应策略)
7. **验证阶段**: 确认优化效果
